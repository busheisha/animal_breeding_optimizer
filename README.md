# Animal Breeding Optimizer

–ú–∏–∫—Ä–æ-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Ä–∞–∑–≤–µ–¥–µ–Ω–∏—è –∂–∏–≤–æ—Ç–Ω—ã—Ö —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ NSGA-II.

## –û–ø–∏—Å–∞–Ω–∏–µ

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∞ –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–±–æ—Ä–∞ –ø–∞—Ä –∂–∏–≤–æ—Ç–Ω—ã—Ö —Å —É—á—ë—Ç–æ–º:
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–æ–¥—Å—Ç–≤–∞ (–∏–Ω–±—Ä–∏–¥–∏–Ω–≥–∞)
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–∞ –ø–ª–µ–º–µ–Ω–Ω–æ–π —Ü–µ–Ω–Ω–æ—Å—Ç–∏, float (EBV - Estimated Breeding Values)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
- –ú–Ω–æ–≥–æ–∫—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### üß¨ –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω—ã—Ö
- –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Ä–æ–¥–æ—Å–ª–æ–≤–Ω–æ–π
- –ü–æ—Å—Ç—Ä–æ–µ–Ω–∏–µ –≥—Ä–∞—Ñ–æ–≤ —Ä–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Å–≤—è–∑–µ–π
- –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –ø—Ä–µ–¥–∫–æ–≤ –¥–æ N –ø–æ–∫–æ–ª–µ–Ω–∏–π

### üîó –†–∞—Å—á—ë—Ç —Ä–æ–¥—Å—Ç–≤–∞
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Ä–æ–¥—Å—Ç–≤–∞ –º–µ–∂–¥—É –∂–∏–≤–æ—Ç–Ω—ã–º–∏
- –ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –∏–Ω–±—Ä–∏–¥–∏–Ω–≥–∞
- –ú–∞—Ç—Ä–∏—Ü–∞ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–æ–¥—Å—Ç–≤–∞ –¥–ª—è –≤—Å–µ—Ö –ø–∞—Ä

### üéØ –ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- –ú–Ω–æ–≥–æ–∫—Ä–∏—Ç–µ—Ä–∏–∞–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å –ø–æ–º–æ—â—å—é NSGA-II
- –£—á—ë—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –ø–æ —Ä–æ–¥—Å—Ç–≤—É
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤
- –ú–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏—è —Å—Ä–µ–¥–Ω–µ–≥–æ EBV –ø–æ—Ç–æ–º–∫–æ–≤

### üìä –ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ EBV –¥–ª—è —Å–∞–º–æ–∫ –∏ —Å–∞–º—Ü–æ–≤
- –ê–Ω–∞–ª–∏–∑ –≤–ª–∏—è–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ –ø–æ —Ä–æ–¥—Å—Ç–≤—É
- –û—Ç—á—ë—Ç—ã –∏ –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repository-url>
cd animal-breeding-optimizer

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
pip install pandas numpy networkx deap 
```

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```python
from animal_breeding_optimizer import (
    load_and_prepare_data,
    KinshipCalculator,
    BreedingOptimizer,
    create_offspring_matrix
)

# –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
dams_df, sires_df, pedigree_processor = load_and_prepare_data(
    'dams.csv', 'sires.csv', 'pedigree.csv'
)

# –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —Ä–æ–¥—Å—Ç–≤–æ
kinship_calculator = KinshipCalculator(pedigree_processor)
kinship_matrix = kinship_calculator.calculate_kinship_matrix(dams_df, sires_df)

# –°–æ–∑–¥–∞—ë–º –º–∞—Ç—Ä–∏—Ü—É –ø–æ—Ç–æ–º–∫–æ–≤
offspring_matrix = create_offspring_matrix(
    dams_df, sires_df, kinship_matrix, kinship_threshold=0.05
)

# –û–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ–º
optimizer = BreedingOptimizer(offspring_matrix, max_assign_per_sire=0.1)
result_df, best_individual, hall_of_fame = optimizer.optimize(
    pop_size=100, ngen=50
)

print(f"–õ—É—á—à–µ–µ —Å—Ä–µ–¥–Ω–µ–µ EBV: {best_individual.fitness.values[0]:.2f}")
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –í—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã

**dams.csv** (—Å–∞–º–∫–∏):
```csv
id,ebv
UA77642,266.5
Zhuchka,0.0
...
```

**sires.csv** (—Å–∞–º—Ü—ã):
```csv
id,ebv
Gektor,468.0
1842,350.0
...
```

**pedigree.csv** (—Ä–æ–¥–æ—Å–ª–æ–≤–Ω–∞—è):
```csv
id,mother_id,father_id
047882,RU8833,Khirs
...
```

### –í—ã—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–µ–∑—É–ª—å—Ç–∞—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏**:
```csv
Dam,Assigned_Sire
76421,Gektor
Zhuchka,7421155
...
```

## –û—Å–Ω–æ–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã

### PedigreeProcessor
–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ —Ä–æ–¥–æ—Å–ª–æ–≤–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

```python
processor = PedigreeProcessor('pedigree.csv')
processor.load_and_clean_pedigree()
graph = processor.build_pedigree_graph()
```

### KinshipCalculator
–†–∞—Å—á—ë—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ —Ä–æ–¥—Å—Ç–≤–∞ –∏ –∏–Ω–±—Ä–∏–¥–∏–Ω–≥–∞.

```python
calculator = KinshipCalculator(pedigree_processor)
kinship = calculator.calculate_kinship(dam_id, sire_id)
inbreeding = calculator.calculate_inbreeding(animal_id)
```

### BreedingOptimizer
–ì–µ–Ω–µ—Ç–∏—á–µ—Å–∫–∏–π –∞–ª–≥–æ—Ä–∏—Ç–º –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ–¥–±–æ—Ä–∞ –ø–∞—Ä.

```python
optimizer = BreedingOptimizer(offspring_matrix, max_assign_per_sire=0.1)
result_df, best_individual, hall_of_fame = optimizer.optimize(
    pop_size=100, ngen=50, cxpb=0.8, mutpb=0.2
)
```

### DataAnalyzer
–ê–Ω–∞–ª–∏–∑ –¥–∞–Ω–Ω—ã—Ö –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤.

```python
ebv_stats = DataAnalyzer.analyze_ebv_statistics(dams_df, sires_df)
filtering_stats = DataAnalyzer.analyze_kinship_filtering(
    kinship_matrix, offspring_matrix
)
DataAnalyzer.print_analysis_report(ebv_stats, filtering_stats)
```

## –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

- **kinship_threshold**: –ø–æ—Ä–æ–≥ —Ä–æ–¥—Å—Ç–≤–∞ –¥–ª—è –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ø–∞—Ä (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.05)
- **max_assign_per_sire**: –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–æ–ª—è —Å–∞–º–æ–∫ –Ω–∞ –æ–¥–Ω–æ–≥–æ —Å–∞–º—Ü–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0.1)
- **pop_size**: —Ä–∞–∑–º–µ—Ä –ø–æ–ø—É–ª—è—Ü–∏–∏ –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ ("–æ—Å–æ–±—å" –≤ –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–º –∞–ª–≥–æ—Ä–∏—Ç–º–µ -- —ç—Ç–æ –Ω–µ —Ä–µ–∞–ª—å–Ω–æ–µ –∂–∏–≤–æ—Ç–Ω–æ–µ, –∞ "–≤–∞—Ä–∏–∞–Ω—Ç –æ—Ç–≤–µ—Ç–∞", –≤ –Ω–∞—à–µ–º —Å–ª—É—á–∞–µ -- –ø–ª–∞–Ω–∞ –≤—è–∑–æ–∫)
- **ngen**: –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–∫–æ–ª–µ–Ω–∏–π –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞
- **cxpb**: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–∫—Ä–µ—â–∏–≤–∞–Ω–∏—è (—Å–∫—Ä–µ—â–∏–≤–∞–Ω–∏–µ -- —ç—Ç–æ —Å–∏–Ω—Ç–µ–∑ –∏–∑ "–æ—Å–æ–±–µ–π" –≥–µ–Ω–µ—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞)
- **mutpb**: –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –º—É—Ç–∞—Ü–∏–∏ (—Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Å–ª–µ–¥—É—é—â–µ–º –ø–æ–∫–æ–ª–µ–Ω–∏–∏)

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

–°–º. —Ñ–∞–π–ª `example_usage.py` –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞ —Ä–∞–±–æ—Ç—ã —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π.

## –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.7+
- pandas
- numpy
- networkx
- deap

## –õ–∏—Ü–µ–Ω–∑–∏—è

MIT License

## –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ issues –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. 